/* global ArchetypeCustomizerConfig, ArchetypeCustomizerl10n, alert */
/**
 * Customizer enhancements.
 *
 * Contains handlers for svg logo, component order, toggle controls, & importing and exporting theme mods.
 *
 * @since 1.0.0
 */
!function(a){"use strict";var b,c,d,e,f,g,h={init:function(){h.autoFocus(),h.siteLogo(),h.componentOrder(),h.componentToggle(),h._radioButtonsInit(),h._toggleInit(),a(document).on("click","input[name=customize-import-button]",h.importMods),a(document).on("click","input[name=customize-export-button]",h.exportMods)},cacheSelectors:function(){var h=a("iframe").contents();b=a("body",h),c=a(".site-logo-link",h),d=a(".site-logo",h),e=a(".svg-site-logo",h),f=a(".site-branding",h),g=d.attr("data-size",h)},autoFocus:function(){a(".archetype-autofocus").on("click",function(){var b=wp.customize.section(a(this).data("id"));b&&(b.focus(),wp.customize.previewer.previewUrl.set(wp.customize.settings.url.home))})},siteLogo:function(){wp.customize("site_logo",function(a){a.bind(function(a){
// Grab selectors the first time through.
b||h.cacheSelectors(),a&&a.url?(d.hide(),f.hide(),a.sizes[g]||(g="full"),e.css({height:a.sizes[g].height,width:a.sizes[g].width}),"block"!==e.css("display")&&d.show()):f.show()})}),wp.customize("archetype_site_logo_svg",function(f){f.bind(function(f){var g,i,j;
// Grab selectors the first time through.
b||h.cacheSelectors(),f?(g={action:"archetype-get-logo-url",wp_customize:"on",id:f,"customize-logo":ArchetypeCustomizerConfig.logoNonce},a.post(ArchetypeCustomizerConfig.ajaxURL,g,function(a){a.data&&a.data.message?(alert(a.data.message),d.show()):a.success&&(i=d.attr("width"),j=d.attr("height"),d.hide(),e.css({display:"block","background-image":"url("+a.data+")","background-repeat":"no-repeat","background-size":"contain",width:i,height:j}),c.is(":hidden")&&alert(ArchetypeCustomizerl10n.missingLogo))})):(d.show(),e.css({display:"none"}))})})},componentOrder:function(){a(".component-order").each(function(){var b=this,c=a(b).next(".component-order-input");a(b).sortable({axis:"y"}),a(b).disableSelection(),a(b).bind("sortstop",function(a){h.componentSort(a.target,c)}),a(".ui-sortable-handle",b).bind("click",function(a){a.preventDefault()}),a(".component-visibility",b).bind("click",function(){a(this).parent("li").toggleClass("disabled"),h.componentSort(b,c)})})},componentSort:function(b,c){var d=[];a(b).find("li").each(function(){a(this).hasClass("disabled")?d.push("[disabled]"+a(this).attr("id")):d.push(a(this).attr("id"))}),d=d.join(","),c.attr("value",d).trigger("change")},componentToggle:function(){var b={header:"archetype_header_layout"};a.each(b,function(b,c){wp.customize(c,function(b){b.bind(function(b){a(".component-order").each(function(){var d=this,e=a(d).data();c===e.id&&(~e.value.indexOf(b)?a(d).parent("label").show():a(d).parent("label").hide())})})})})},_radioButtonsInit:function(){a.fn.buttonset&&a(".radio-buttons").each(function(){var b=this;
// Create the button set.
a(b).buttonset(),
// Adds keyboard navigation.
a("label",b).on("keydown",function(c){13===c.which&&(c.preventDefault(),a(c.target).click(),a(b).buttonset("refresh"))})})},_toggleInit:function(){var a={"input[data-customize-setting-link=archetype_header_subscribe_and_connect_theme_override]":"#customize-control-archetype_header_subscribe_and_connect_theme","input[data-customize-setting-link=archetype_boxed]":"#customize-control-archetype_boxed_background_color","input[data-customize-setting-link=archetype_post_shadow_toggle]":"#customize-control-archetype_post_shadow_color","input[data-customize-setting-link=archetype_search_shadow_toggle]":"#customize-control-archetype_search_shadow_color","!input[data-customize-setting-link=archetype_button_2d]":"#customize-control-archetype_button_shadow_color, #customize-control-archetype_button_shadow_hover_color","input[data-customize-setting-link=archetype_upsell_display_toggle]":"#customize-control-archetype_upsell_display_limit, #customize-control-archetype_upsell_display_limit_text, #customize-control-archetype_upsell_display_columns, #customize-control-archetype_upsell_display_columns_text","input[data-customize-setting-link=archetype_related_products_toggle]":"#customize-control-archetype_related_products_limit, #customize-control-archetype_related_products_limit_text, #customize-control-archetype_related_products_columns, #customize-control-archetype_related_products_columns_text"};h._toggleEach(a)},_toggleEach:function(b){a.each(b,function(b,c){var d=!1;"!"===b.charAt(0)&&(b=b.substr(1),d=!0),h._toggle(b,c,d),a(document).on("click",b,function(){h._toggle(b,c,d)})})},_toggle:function(b,c,d){var e=a(b),f=a(c);e.prop("checked")?d?f.hide():f.show():d?f.show():f.hide()},importMods:function(){var b=a(window),c=a("body"),d=a('<form class="customize-import-form" method="POST" enctype="multipart/form-data"></form>'),e=a(".customize-import-controls"),f=a("input[name=customize-import-file]"),g=a(".customize-import-uploading");""===f.val()?alert(ArchetypeCustomizerl10n.emptyImport):(b.off("beforeunload"),c.append(d),d.append(e),g.show(),d.submit())},exportMods:function(){return window.location.href=ArchetypeCustomizerConfig.customizerURL+"?customize-export="+ArchetypeCustomizerConfig.exportNonce,!1}};a(h.init)}(jQuery);