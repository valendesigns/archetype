/* global Archetypel10n */
/**
 * Script for initializing globally-used functions and libs.
 *
 * @since 1.0.0
 */
!function(a){"use strict";var b={cache:{},init:function(){this.cacheElements(),this.bindEvents()},cacheElements:function(){this.cache={$window:a(window),$document:a(document)}},bindEvents:function(){var b=this;this.cache.$document.on("ready",function(){b.navigationInit(),b.skipLinkFocusFix(),b.wooCommerceStarRating(),b.sliderInit(),b.fixMobileMenuInit(),b.pinHeaderInit(),b.pinMenuInit(),b.heroInit(),b.cache.$window.on("load",function(){a(this).trigger("resize")})})},/**
		 * Initialize the mobile menu functionality.
		 *
		 * @since 1.0.0
		 *
		 * @return void
		 */
navigationInit:function(){var b=a("#masthead #site-navigation"),c=a("#masthead .handheld-navigation ul");if(0!==b.length&&0!==a("#masthead button.menu-toggle").length){
// Hide menu toggle button if menu is empty and return early.
if(0===c.length)return void a("#masthead button.menu-toggle").hide();c.attr("aria-expanded","false"),
// Fix position by moving the button & display both buttons
0===a("#masthead .secondary-navigation button.menu-toggle").length&&a("#masthead button.menu-toggle").appendTo(".secondary-navigation").css("display","block"),a("a.cart-contents").css("display","block"),
// Listen for button click.
a("#masthead button.menu-toggle").on("click",function(){var d=a(this);b.is(".toggled")?(b.removeClass("toggled"),d.attr("aria-expanded","false"),c.attr("aria-expanded","false")):(b.addClass("toggled"),d.attr("aria-expanded","true"),c.attr("aria-expanded","true"))}),
// Fix header button positions inside wrapper
a("#masthead .secondary-navigation-wrap").length&&(a("#masthead .secondary-navigation-wrap button.menu-toggle").appendTo(".site-header > .col-full"),a("#masthead .secondary-navigation-wrap .site-header-cart").clone().appendTo(".site-header > .col-full")),
// Add focus class to li
a(".main-navigation, .secondary-navigation").find("a").on("focus.archetype blur.archetype",function(){a(this).parents().toggleClass("focus")}),
// Add focus to cart dropdown
a(window).load(function(){a(".site-header-cart").find("a").on("focus.archetype blur.archetype",function(){a(this).parents().toggleClass("focus")})}),
// Hide empty cart dropdown
a(document).on("mouseenter.archetype mouseleave.archetype",".site-header-cart .cart-contents",function(){var b=a(this).parents().next(".widget_shopping_cart");b.find("li:first-child").hasClass("empty")?b.addClass("is-empty"):b.removeClass("is-empty")})}},/**
		 * Fix tab destination after 'Skip to content' link has been clicked.
		 *
		 * @since 1.0.0
		 *
		 * @return void
		 */
skipLinkFocusFix:function(){var a,b=navigator.userAgent.toLowerCase().indexOf("webkit")>-1,c=navigator.userAgent.toLowerCase().indexOf("opera")>-1,d=navigator.userAgent.toLowerCase().indexOf("msie")>-1;(b||c||d)&&"undefined"!=typeof document.getElementById&&(a=window.addEventListener?"addEventListener":"attachEvent",window[a]("hashchange",function(){var a=document.getElementById(location.hash.substring(1));a&&(/^(?:a|select|input|button|textarea)$/i.test(a.tagName)||(a.tabIndex=-1),a.focus())},!1))},/**
		 * WooCommerce star rating
		 *
		 * @since 1.0.0
		 *
		 * @return void
		 */
wooCommerceStarRating:function(){var b="#respond p.stars a";a(b).length&&(a("body").on("mouseenter.archetype",b,function(){a(this).prevAll().toggleClass("toggled")}),a("body").on("mouseleave.archetype",b,function(){a(this).siblings("a").removeClass("toggled")}),a("body").on("click.archetype",b,function(){a(this).siblings("a").removeClass("active"),a(this).addClass("active").prevAll().addClass("active")}))},/**
		 * Initialize Slider
		 *
		 * @since 1.0.0
		 *
		 * @return void
		 */
sliderInit:function(){var b;"function"==typeof jQuery.fn.bxSlider&&(b=a(".bxslider").bxSlider({adaptiveHeight:!0,mode:"fade",pager:!1,nextText:Archetypel10n.next,prevText:Archetypel10n.prev}),a(window).on("orientationchange",function(){b.reloadSlider()}))},fixMobileMenuInit:function(){var b=this;
// Mobile menu vars.
b.$mobileMenu=a("#masthead #navigation"),b.$mobileMenuPrev=b.$mobileMenu.prev(),b.$mobileMenuNext=b.$mobileMenu.next(),b.$mobileMenuMain=a("#masthead > div.col-full"),0!==b.$mobileMenu.length&&
// Event listener.
b.cache.$window.on("resize",a.proxy(b.fixMobileMenu,this))},fixMobileMenu:function(){var a=this,b=a.cache.$window.width();768>b&&a.$mobileMenu.not(".moved-to-end")?a.$mobileMenu.insertAfter(a.$mobileMenuMain).addClass("moved-to-end"):a.$mobileMenu.is(".moved-to-end")&&(0===a.$mobileMenuPrev.length?a.$mobileMenu.insertBefore(a.$mobileMenuNext).removeClass("moved-to-end"):a.$mobileMenu.insertAfter(a.$mobileMenuPrev).removeClass("moved-to-end"))},pinHeaderInit:function(){var b=this;a(".handheld-pin").parents("#masthead").addClass("header-pin"),
// Global menu vars.
b.$header=a(".header-pin"),b.$headerInner=a("#masthead > .col-full"),0!==b.$header.length&&0!==b.$headerInner.length&&(b.$headerClone=b.$header.clone().attr("id","masthead-clone"),b.$headerCloneContainer=b.$headerClone.find("#site-navigation"),b.$headerCloneMenu=b.$headerClone.find(".handheld-navigation ul"),
// Event listeners.
b.cache.$window.on("scroll",a.proxy(b.pinHeader,this)).on("resize",a.proxy(b.pinHeader,this)))},pinHeader:function(){var b,c,d,e=this;
// There is no header.
0!==e.$header.length&&(b=e.$headerInner.offset().top,c=e.cache.$window.scrollTop(),d=e.cache.$window.width(),a("body").hasClass("admin-bar")&&(b-=600>=d?0:46),c>0&&c>=b&&768>d&&d>=600?0===a("#masthead-clone").length&&(e.$headerClone.insertAfter("#masthead").addClass("pinned"),e.$header.addClass("was-pinned"),a("#masthead-clone #navigation").not(".moved-to-end")&&a("#masthead-clone #navigation").insertAfter(a("#masthead-clone > div.col-full")).addClass("moved-to-end"),e.$headerCloneMenu.attr("aria-expanded","false"),e.$headerClone.find("button.menu-toggle").appendTo("#masthead-clone .secondary-navigation").css("display","block"),e.$headerClone.find("a.cart-contents").css("display","block"),e.$headerClone.find("button.menu-toggle").on("click",function(){e.$headerCloneContainer.is(".toggled")?(e.$headerCloneContainer.removeClass("toggled"),e.$headerCloneMenu.attr("aria-expanded","false"),a(this).attr("aria-expanded","false")):(e.$headerCloneContainer.addClass("toggled"),e.$headerCloneMenu.attr("aria-expanded","true"),a(this).attr("aria-expanded","true"))}),a("#masthead #site-navigation").is(".toggled")?(a("#masthead #site-navigation").removeClass("toggled"),a("#masthead .handheld-navigation ul").attr("aria-expanded","false"),a("#masthead button.menu-toggle").attr("aria-expanded","false"),e.$headerCloneContainer.addClass("toggled"),e.$headerCloneMenu.attr("aria-expanded","true"),e.$headerClone.find("button.menu-toggle").attr("aria-expanded","true")):(e.$headerCloneContainer.removeClass("toggled"),e.$headerCloneMenu.attr("aria-expanded","false"),e.$headerClone.find("button.menu-toggle").attr("aria-expanded","false"))):(e.$headerClone.remove(),e.$header.removeClass("was-pinned header-pin"),e.$header.find("a.cart-contents").css("display","block")))},pinMenuInit:function(){var b=this;
// Global menu vars.
b.$menu=a(".navigation-pin"),b.$menuClone=b.$menu.clone(),
// Event listeners.
b.cache.$window.on("scroll",a.proxy(b.pinMenu,this)).on("resize",a.proxy(b.pinMenu,this))},pinMenu:function(){var b,c,d,e;
// There is no menu.
0!==this.$menu.length&&(b=this.$menu.offset().top,c=this.cache.$window.scrollTop(),d=this.cache.$window.width(),a("body").hasClass("admin-bar")&&(e=32,600>=d&&(e=0),782>=d&&(e=46),b-=e),c>0&&c>=b&&d>767?0===a("#masthead + .navigation-pin").length&&(this.$menuClone.insertAfter("#masthead").addClass("pinned"),this.$menu.addClass("was-pinned")):(this.$menuClone.remove(),this.$menu.removeClass("was-pinned")))},heroInit:function(){var b=this,c=!1;
// Global hero vars.
b.$hero=a(".archetype-hero"),b.$heroCol=b.$hero.find(".col-full"),b.$heroContent=b.$hero.find(".archetype-hero-content"),b.$heroMedia=b.$hero.find(".archetype-hero-media"),c=b.$hero.hasClass("archetype-hero-transition-reverse"),b.$hero.hasClass("archetype-hero-add-transition")?(b.slideShake(b.$heroContent,{shakes:1,distance:c?3:4,duration:c?300:400,slidePosition:c?3e3:-3e3,slideDuration:150}),b.slideShake(b.$heroMedia,{distance:2,slidePosition:c?-3e3:3e3})):(b.makeVisible(b.$heroContent),b.makeVisible(b.$heroMedia)),b.$hero.hasClass("archetype-hero-has-grid")&&b.$hero.hasClass("archetype-hero-position-media")&&b.cache.$window.on("resize",a.proxy(b.pinHeroMedia,this))},pinHeroMedia:function(){var b=this.$heroCol.outerHeight(!0),c=this.$heroMedia.height(),d=this.$heroContent.height(),e=Math.abs(parseFloat(this.$heroMedia.css("margin-bottom")))/2,f=c+e,g=a(window).width();g>767&&(b>f||d>c)?this.$heroMedia.css({top:b-f}):this.$heroMedia.css({top:"auto"})},makeVisible:function(b){return b.each(function(){a(this).css({opacity:0,visibility:"visible"}).animate({opacity:1},0)})},slideShake:function(b,c){var d,e={shakes:2,distance:5,duration:500,slidePosition:3e3,slideDelay:150,slideDuration:250};return c&&a.extend(e,c),b.each(function(){var b,c,f=a(this);for(d=f.css("position"),d&&"static"!==d||f.css("position","relative"),f.css({opacity:0,visibility:"visible",left:e.slidePosition}).animate({opacity:1},0).delay(e.slideDelay).animate({left:0},e.slideDuration),b=1;b<=e.shakes;b++)c=e.shakes/2<=b?2:1,f.animate({left:e.distance*-c},e.duration/e.shakes/4).animate({left:e.distance*c},e.duration/e.shakes/2).animate({left:0},e.duration/e.shakes/4)})}};b.init()}(jQuery);